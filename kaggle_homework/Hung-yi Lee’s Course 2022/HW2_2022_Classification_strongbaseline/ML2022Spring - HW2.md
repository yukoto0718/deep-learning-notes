
# HW 2 	Classification

Homework 2 Phoneme Classification

**kaggle url:** [ML2022Spring-hw2](https://www.kaggle.com/competitions/ml2022spring-hw2/overview)
**PDF url:** [HW02.pdf](https://speech.ee.ntu.edu.tw/~hylee/ml/ml2022-course-data/hw2_slides%202022.pdf)

### Task Introduction
ãƒ»Data Preprocessing: Extract MFCC features from raw waveform (already
done)
ãƒ»Classification: Perform framewise phoneme classification using
pre-extracted MFCC features


### Grading -- Kaggle and Hints
```
---- simple baseline ----
Score:0.45797
(original)ML2022Spring_HW2.ipynb

---- medium baseline ----
Score: 0.69747 
concat n frames, add layers

---- strong baseline ----
Score:0.75028
concat n, batchnorm, dropout, add layers

---- boss baseline ----
Score: 0.82324
sequence-labeling(using RNN)
```

### Analysis
**1.å„ä¸ªæ–‡ä»¶çš„ä½œç”¨**
```
| æ–‡ä»¶å             | å†…å®¹               | ä½œç”¨                  |
|-------------------|-------------------|-----------------------|
| train_split.txt   | è®­ç»ƒæ•°æ®çš„æ–‡ä»¶ååˆ—è¡¨ | å‘Šè¯‰æˆ‘ä»¬å“ªäº›å½•éŸ³ç”¨æ¥è®­ç»ƒ  | 
| test_split.txt    | æµ‹è¯•æ•°æ®çš„æ–‡ä»¶ååˆ—è¡¨ | å‘Šè¯‰æˆ‘ä»¬å“ªäº›å½•éŸ³ç”¨æ¥æµ‹è¯•  |
| train_labels.txt  | è®­ç»ƒæ•°æ®çš„æ ‡ç­¾      | æ¯ä¸€å¸§å¯¹åº”å“ªä¸ªéŸ³ç´ ï¼ˆç­”æ¡ˆï¼‰| 
| feat/train/*.pt   | è®­ç»ƒç‰¹å¾æ–‡ä»¶        | æ¯ä¸ªå½•éŸ³çš„ MFCC ç‰¹å¾æ•°æ®|
| feat/test/*.pt    | æµ‹è¯•ç‰¹å¾æ–‡ä»¶        | æµ‹è¯•å½•éŸ³çš„ MFCC ç‰¹å¾   | 
```

**2.ä»€ä¹ˆæ˜¯MFCCç‰¹å¾ï¼Ÿ**

**MFCC = æ¢…å°”é¢‘ç‡å€’è°±ç³»æ•°**

**ç±»æ¯”ï¼š**

- åŸå§‹è¯­éŸ³å°±åƒä¸€é¦–å¤æ‚çš„äº¤å“ä¹
- MFCCå°±åƒæŠŠè¿™é¦–äº¤å“ä¹ç®€åŒ–æˆä¸€ä¸ª"å£°éŸ³æŒ‡çº¹"
- æ¯ä¸€å¸§çš„MFCCæ˜¯39ä¸ªæ•°å­—ï¼Œæè¿°äº†è¿™25æ¯«ç§’å†…å£°éŸ³çš„ç‰¹å¾

```
åŸå§‹è¯­éŸ³æ³¢å½¢ â†’ [å¤æ‚çš„æ³¢æµªçº¿]
â†“ MFCCæå–
æ¯ä¸€å¸§ â†’ [1.2, -0.5, 2.1, 0.8, ...] (39ä¸ªæ•°å­—)
```

ğŸ¯ **æˆ‘ä»¬çš„ä»»åŠ¡å…·ä½“æ˜¯ä»€ä¹ˆï¼Ÿ**

**è¾“å…¥ï¼š** ä¸€å¸§è¯­éŸ³çš„MFCCç‰¹å¾ï¼ˆ39ä¸ªæ•°å­—ï¼‰
**è¾“å‡ºï¼š** è¿™ä¸€å¸§å¯¹åº”çš„éŸ³ç´ ç±»åˆ«ï¼ˆ41ç§éŸ³ç´ ä¸­çš„ä¸€ç§ï¼‰

å°±åƒç»™è®¡ç®—æœºçœ‹ä¸€ä¸ª"å£°éŸ³æŒ‡çº¹"ï¼Œè®©å®ƒçŒœè¿™æ˜¯ä»€ä¹ˆéŸ³ç´ ã€‚
```
ä¾‹å¦‚train_labelsçš„19-198-0008ï¼š

å¼€å§‹ï¼š 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0...
     â†‘ é™éŸ³æ®µï¼ˆ53ä¸ª0ï¼‰- è¯´è¯å‰çš„å®‰é™

ç„¶åï¼š 11 11 11 11 11 11 11 11 11 11 11 11
     â†‘ éŸ³ç´ 11æŒç»­äº†12å¸§ï¼ˆå¤§çº¦120æ¯«ç§’ï¼‰

æ¥ç€ï¼š 39 39 39 39 39 39
     â†‘ éŸ³ç´ 39æŒç»­äº†6å¸§ï¼ˆå¤§çº¦60æ¯«ç§’ï¼‰

ç»§ç»­ï¼š 35 35 35 35 35 35 35
     â†‘ éŸ³ç´ 35æŒç»­äº†7å¸§

...ä¾æ­¤ç±»æ¨...

ç»“å°¾ï¼š 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
     â†‘ åˆæ˜¯é™éŸ³æ®µ - è¯´è¯åçš„å®‰é™
```
```
19-198-0008  0   0   0   11  11  39  39  35  35  25  25  ...
             â†“   â†“   â†“   â†“   â†“   â†“   â†“   â†“   â†“   â†“   â†“
            å¸§1 å¸§2 å¸§3 å¸§4 å¸§5 å¸§6 å¸§7 å¸§8 å¸§9 å¸§10å¸§11 ...
   ____________________________________________________________
   
19-198-0008.pt:
tensor([
    [1.23, -0.45, 2.1, ..., 0.67],  # å¸§1: 39ä¸ªæ•°å­— â†’ æ ‡ç­¾: 0 (é™éŸ³)
    [1.19, -0.42, 2.0, ..., 0.71],  # å¸§2: 39ä¸ªæ•°å­— â†’ æ ‡ç­¾: 0 (é™éŸ³)  
    [1.15, -0.38, 1.9, ..., 0.63],  # å¸§3: 39ä¸ªæ•°å­— â†’ æ ‡ç­¾: 0 (é™éŸ³)
    [2.34, 1.23, -0.8, ..., 1.45],  # å¸§4: 39ä¸ªæ•°å­— â†’ æ ‡ç­¾: 11 (éŸ³ç´ /d/)
    [2.41, 1.31, -0.7, ..., 1.52],  # å¸§5: 39ä¸ªæ•°å­— â†’ æ ‡ç­¾: 11 (éŸ³ç´ /d/)
    [3.12, 0.89, 2.1, ..., 0.88],   # å¸§6: 39ä¸ªæ•°å­— â†’ æ ‡ç­¾: 39 (éŸ³ç´ /zh/)
    [3.08, 0.91, 2.0, ..., 0.92],   # å¸§7: 39ä¸ªæ•°å­— â†’ æ ‡ç­¾: 39 (éŸ³ç´ /zh/)
    ...
])
   ____________________________________________________________
   
æ—¶é—´:    0ms    25ms   50ms   75ms   100ms  125ms  150ms  ...
å¸§å·:    å¸§1    å¸§2    å¸§3    å¸§4    å¸§5    å¸§6    å¸§7    ...
æ ‡ç­¾:     0      0      0     11     11     39     39    ...
ç‰¹å¾:   39ä¸ª   39ä¸ª   39ä¸ª   39ä¸ª   39ä¸ª   39ä¸ª   39ä¸ª   ...
```

**3.concat_nframes - å¸§æ‹¼æ¥æ•°é‡**

```python
concat_nframes = 1              
# the number of frames to concat with, n must be odd (total 2k+1 = n frames)
```

**è¯¦ç»†è§£é‡Šï¼š**
- **ä½œç”¨**: å†³å®šæ¯ä¸€å¸§è¦"çœ‹"å¤šå°‘ç›¸é‚»å¸§çš„ä¿¡æ¯
- **å½“å‰å€¼**: 1ï¼ˆåªçœ‹å½“å‰å¸§ï¼Œä¸çœ‹å‰åå¸§ï¼‰
- **å¿…é¡»å¥‡æ•°**: ç¡®ä¿æœ‰æ˜ç¡®çš„"ä¸­å¿ƒå¸§"

**ä¸åŒå€¼çš„æ•ˆæœï¼š**
```python
concat_nframes = 1: åªçœ‹å½“å‰å¸§
                    [å½“å‰å¸§] â†’ 39ä¸ªç‰¹å¾

concat_nframes = 3: çœ‹å‰1å¸§+å½“å‰+å1å¸§  
                    [å‰å¸§][å½“å‰å¸§][åå¸§] â†’ 39Ã—3=117ä¸ªç‰¹å¾

concat_nframes = 5: çœ‹å‰2å¸§+å½“å‰+å2å¸§
                    [å‰å‰][å‰][å½“å‰][å][åå] â†’ 39Ã—5=195ä¸ªç‰¹å¾
```

**è°ƒå‚å»ºè®®ï¼š**
- **å€¼è¶Šå¤§**: æ¨¡å‹çœ‹åˆ°æ›´å¤šä¸Šä¸‹æ–‡ï¼Œå¯èƒ½æ›´å‡†ç¡®ï¼Œä½†è®¡ç®—é‡æ›´å¤§
- **å€¼è¶Šå°**: è®¡ç®—å¿«ï¼Œä½†å¯èƒ½ä¸¢å¤±é‡è¦çš„æ—¶åºä¿¡æ¯
- **ç»éªŒå€¼**: é€šå¸¸3-11æ•ˆæœè¾ƒå¥½




### strongbaseline
**1.Hyper-parameterséƒ¨åˆ†:** 
```
# åŸºç¡€ç‰ˆæœ¬ â†’ stronglineç‰ˆæœ¬
concat_nframes = 1    â†’  concat_nframes = 19
batch_size = 512      â†’  batch_size = 2048  
num_epoch = 5         â†’  num_epoch = 50
hidden_layers = 1     â†’  hidden_layers = 3
hidden_dim = 256      â†’  hidden_dim = 1024

# stronglineæ–°å¢çš„å‚æ•°ï¼š
early_stopping = 8    # æ–°å¢ï¼šæ—©åœè½®æ•°
```
**2.æ­£åˆ™åŒ–:** 
```python
#(1)L2æ­£åˆ™åŒ–ï¼ˆæƒé‡è¡°å‡ï¼‰
optimizer = torch.optim.AdamWï¼ˆ.â€¢ weight_decay=0.01ï¼‰
#(2)Dropoutæ­£åˆ™åŒ–
nn.Dropout ï¼ˆ0.35ï¼‰
#(3)BatchNormæ­£åˆ™åŒ–
nn.BatchNorm1dï¼ˆoutput_dimï¼‰
#(4)æ—©åœæ­£åˆ™åŒ–
early_stopping = 8
```
**3.ä¼˜åŒ–å™¨é…ç½®&å­¦ä¹ ç‡:** 
```python
# stronglineæ–°å¢çš„ä¼˜åŒ–å™¨é…ç½®
optimizer = torch.optim.AdamW(model.parameters(), 
                              lr=learning_rate*5,      # å­¦ä¹ ç‡æé«˜5å€
                              weight_decay=0.01)       # æ–°å¢ï¼šæƒé‡è¡°å‡

# stronglineæ–°å¢çš„å­¦ä¹ ç‡è°ƒåº¦å™¨
scheduler = torch.optim.lr_scheduler.CosineAnnealingWarmRestarts(
    optimizer, T_0=8, T_mult=2, eta_min=learning_rate/2)
```

### bossbaseline
**1.MLPæ”¹æˆBiLSTM-CRF**ï¼Ÿ

**2.Post-processing**ï¼Ÿ

